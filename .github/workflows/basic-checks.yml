# Basic CI checks that should always pass
name: Basic Checks

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  # Quick validation checks
  validate-structure:
    name: Validate Repository Structure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check required files exist
        run: |
          echo "Checking for implementation files..."
          
          # Check JavaScript frameworks
          test -f implementations/react/package.json || exit 1
          test -f implementations/vue/package.json || exit 1
          test -f implementations/angular/package.json || exit 1
          
          # Check Rust frameworks
          test -f implementations/leptos/Cargo.toml || exit 1
          test -f implementations/yew/Cargo.toml || exit 1
          test -f implementations/dioxus/Cargo.toml || exit 1
          
          # Check PHP framework
          test -f implementations/blade/composer.json || exit 1
          
          # Check Dockerfiles
          test -f implementations/react/Dockerfile || exit 1
          test -f implementations/vue/Dockerfile || exit 1
          test -f implementations/angular/Dockerfile || exit 1
          test -f implementations/leptos/Dockerfile || exit 1
          test -f implementations/yew/Dockerfile || exit 1
          test -f implementations/dioxus/Dockerfile || exit 1
          test -f implementations/blade/Dockerfile || exit 1
          
          # Check docker-compose
          test -f docker-compose.yml || exit 1
          
          echo "✅ All required files exist!"
      
      - name: Check documentation exists
        run: |
          echo "Checking documentation..."
          test -f README.md || exit 1
          test -f DOCKER.md || exit 1
          test -f BENCHMARK_GUIDE.md || exit 1
          test -f QUICKSTART_DOCKER.md || exit 1
          echo "✅ Documentation files exist!"

  # JavaScript frameworks - quick syntax check
  check-javascript:
    name: Check JavaScript Frameworks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Check React package.json
        working-directory: implementations/react
        run: |
          npm install --package-lock-only
          echo "✅ React dependencies resolved"
      
      - name: Check Vue package.json
        working-directory: implementations/vue
        run: |
          npm install --package-lock-only
          echo "✅ Vue dependencies resolved"
      
      - name: Check Angular package.json
        working-directory: implementations/angular
        run: |
          npm install --package-lock-only
          echo "✅ Angular dependencies resolved"

  # Rust frameworks - quick cargo check
  check-rust:
    name: Check Rust Frameworks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Rust
        uses: actions-rust-lang/setup-rust-toolchain@v1
        with:
          toolchain: stable
          target: wasm32-unknown-unknown
      
      - name: Check Leptos
        working-directory: implementations/leptos
        run: |
          cargo check --quiet
          echo "✅ Leptos compiles"
      
      - name: Check Yew
        working-directory: implementations/yew
        run: |
          cargo check --quiet
          echo "✅ Yew compiles"
      
      - name: Check Dioxus
        working-directory: implementations/dioxus
        run: |
          cargo check --quiet
          echo "✅ Dioxus compiles"

  # PHP framework - quick check
  check-php:
    name: Check PHP Framework
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
      
      - name: Check Blade syntax
        working-directory: implementations/blade
        run: |
          php -l index.php
          echo "✅ Blade PHP syntax valid"

  # Docker files validation
  check-docker:
    name: Validate Docker Configurations
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Validate docker-compose.yml
        run: |
          docker compose config > /dev/null
          echo "✅ docker-compose.yml is valid"
      
      - name: Check Dockerfile syntax
        run: |
          for dockerfile in implementations/*/Dockerfile; do
            echo "Checking $dockerfile..."
            docker run --rm -i hadolint/hadolint < "$dockerfile" || echo "Warnings found but continuing..."
          done
          echo "✅ Dockerfiles checked"

  # Summary
  all-basic-checks-passed:
    name: All Basic Checks Passed
    runs-on: ubuntu-latest
    needs:
      - validate-structure
      - check-javascript
      - check-rust
      - check-php
      - check-docker
    steps:
      - name: Success
        run: |
          echo "✅ All basic checks passed!"
          echo ""
          echo "Repository structure: ✅"
          echo "JavaScript frameworks: ✅"
          echo "Rust frameworks: ✅"
          echo "PHP framework: ✅"
          echo "Docker configurations: ✅"
